{% extends "website/base.html" %}
{% load web_extras %}
{% load static %}

{% block extra_scripts %}
    <script src="{% static 'website/likedislike.js' %}"></script>
{% endblock %}


{% block sidebar %}
    <p style="text-align:center; margin-right: 20%;">Recent posts</p>
    <ul>
        <div style="list-style-type: none;">
            <li>

                {% for post in latest_reviews.all %}
                        <a href="{% url 'website:post' post.id %}">
                            <div class="sidebar-list-element">

                                <h5 style="margin-top: 0.5rem; margin-left: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;;">{{ post.title }}</h5>
                            </div>
                        </a>
                {% endfor %}

            </li>
        </div>
    </ul>

    <div>
        <p style="text-align:center; margin-right: 20%;">Recently added games</p>
        <ul>
            <div style="list-style-type: none; margin-top: 25%">
                <li>

                    {% for game in latest_games.all %}
                            <a href="{% url 'website:game' game.id %}">
                                <div class="sidebar-list-element">

                                    <h5 style="margin-top: 0.5rem; margin-left: 5px; overflow: hidden; text-overflow: ellipsis;">{{ game.title }}</h5>
                                </div>
                            </a>
                    {% endfor %}

                </li>
            </div>
        </ul>
    </div>
{% endblock %}

{% block main %}
    {% if games_list %}
        <form method="get">
            <select name="sort" id="sort" style="margin-left: 60px;">
                <option value="title" {% if sort == 'title' %} selected {% endif %}>A-Z</option>
                <option value="-title" {% if sort == '-title' %} selected {% endif %}>Z-A</option>
                <option value="popularity" {% if sort == 'popularity' %} selected {% endif %}>Most Popular</option>
                <option value="postcount" {% if sort == 'postcount' %} selected {% endif %}>Most Reviewed</option>
                <option value="releasedate" {% if sort == 'releasedate' %} selected {% endif %}>Release Date Ascending</option>
                <option value="-releasedate" {% if sort == '-releasedate' %} selected {% endif %}>Release Date Descending</option>
                <option value="id" {% if sort == 'id' %} selected {% endif %}>Added Ascending</option>
                <option value="-id" {% if sort == '-id' %} selected {% endif %}>Added Descending</option>
            </select>
            <input type="submit" value="Sort">
        </form>

        <ul>
            <div class="list">
                    {% for game in games_list %}
                                <div class="list-element" style="{% cycle 'background-color: #f2f2f2;' 'background-color: #ffffff;' %}">
                                    <a href="{% url 'website:game' game.id %}">
                                    {% if game.image %}
                                        <img src="{% url 'website:get_image' game.image.id %}">
                                    {% else %}
                                        <img src="" alt="No image">
                                    {% endif %}

                                    <h3>{{ game.title }}</h3>
                                    <div class="list-text">
                                        {{ game.description }}
                                    </div>
                                        <p>
                                            {% if game.publisher %}
                                                Developer: <a href="{% url 'website:developer' game.developer.id %}">{{ game.developer.title }}</a>
                                            {% else %}
                                                <br>
                                            {% endif %}
                                            <br>
                                            {% if game.publisher %}
                                                Publisher: <a href="{% url 'website:publisher' game.publisher.id %}">{{ game.publisher.title }}</a>
                                            {% endif %}
                                        </p>
                                    </a>

                                    {% if request.user.is_staff %}
                                        <a id="delete" href="{% url 'website:delete' 'game' game.id %}">delete</a>
                                    {% endif %}

                                    <div class="like-dislike">
                                        {% if request.user.is_authenticated %}
                                            <button
                                                    id="like{{ game.id }}"
                                                    type="button"
                                                    onclick="like_game({{ game.id }});"
                                                    style="{% if game|is_liked:request.user %}color: #00b300;{% else %}color: #000000;{% endif %}"
                                            >▲</button>

                                            <span id="score{{ game.id }}">{{ game|count_likes }}</span>

                                            <button
                                                    id="dislike{{ game.id }}"
                                                    type="button"
                                                    onclick="dislike_game({{ game.id }});"
                                                    style="{% if game|is_disliked:request.user %}color: #b30000;{% else %}color: #000000;{% endif %}"
                                            >▼</button>
                                        {% else %}
                                            ▲ {{ game|count_likes }} ▼
                                        {% endif %}
                                    </div>
                                </div>
                    {% endfor %}
                </li>
            </div>
        </ul>

    {% else %}
        <p>No games are available.</p>
    {% endif %}

{% endblock %}
